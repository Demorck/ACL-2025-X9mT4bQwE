<% 
  const dayName = new Date(year, month, day)
    .toLocaleDateString('fr-FR', { weekday: 'long' })
    .replace(/^./, c => c.toUpperCase());
%>

<% 
  const currentDay = new Date(year, month, day);
  
  const nextDay = new Date(currentDay);
  nextDay.setDate(currentDay.getDate() + 1);

  const prevDay = new Date(currentDay);
  prevDay.setDate(currentDay.getDate() - 1);
%>


<div class="flex justify-between items-center mb-6">
  <a href="/agendas?month=<%= month %>&year=<%= year %>" class="px-3 py-2 bg-stone-800 rounded hover:bg-stone-600">Retour</a>
  <a href="/daily?day=<%= prevDay.getDate() %>&month=<%= prevDay.getMonth() %>&year=<%= prevDay.getFullYear() %>" class="px-3 py-2 bg-stone-800 rounded hover:bg-stone-600">←</a>

  <h1 class="text-2xl font-bold"><%= dayName %> <%= day %>/<%= +month+1 %>/<%= year %></h1>

  <a href="/daily?day=<%= nextDay.getDate() %>&month=<%= nextDay.getMonth() %>&year=<%= nextDay.getFullYear() %>" class="px-3 py-2 bg-stone-800 rounded hover:bg-stone-600">→</a>
  <a href="/appointment/new?day=<%= day %>&month=<%= month %>&year=<%= year %>" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-400">+ Ajouter</a>
</div>


<div class="relative border border-stone-800 rounded bg-stone-700 overflow-hidden flex flex-1" style="height: 1200px;">
  <div class="absolute left-0 top-0 w-16 h-full border-r border-stone-600 bg-stone-800">
    <% for (let h = 0; h < 24; h++) { %>
      <div 
        class="absolute text-stone-300 text-xs text-right pr-2"
        style="top: calc(<%= (h / 24) * 100 %>%); height: calc(100% / 24); width: 100%;">
        <%= h.toString().padStart(2, "0") %>h
      </div>
    <% } %>
  </div>

  <div class="absolute left-16 top-0 right-0 h-full">
    <% for (let h = 0; h < 24; h++) { %>
      <div 
        class="absolute left-0 right-0 border-t border-stone-600 <%= h % 2 === 0 ? 'bg-stone-600/20' : '' %>"
        style="top: calc(<%= (h / 24) * 100 %>%); height: calc(100% / 24);">
      </div>
    <% } %>

    <% appointments.forEach(app => { %>
      <div
        class="absolute bg-<%= app.color %>-700 border border-<%= app.color %>-300 rounded px-3 py-2 text-sm text-white shadow-md overflow-hidden hover:bg-<%= app.color %>-600 group"
        style="
          top: calc(<%= (app.startHour / 24) * 100%>%);
          height: calc((<%= app.durationHours %> / 24) * 100%>%);
          left: calc(<%= (app.colIndex / app.colCount) * 100%>%);
          width: calc(<%= (1 / app.colCount) * 100%>%);
        ">
        <strong><%= app.nom %></strong>

        <div class="inline-flex space-x-1 rdv-actions invisible group-hover:visible">
            <form method="POST" action="/rdv/modif" class="m-0 p-0 leading-none">
              <input type="hidden" name="id" value="<%= app.id %>">
              <input type="hidden" name="day" value="<%= day %>">
              <input type="hidden" name="month" value="<%= month %>">
              <input type="hidden" name="year" value="<%= year %>">
              <input type="hidden" name="agendaId" value="<%= app.agendaId %>">
              <button
                  type="submit"
                  class="bg-blue-600 hover:bg-blue-400 w-4 h-4 rounded flex items-center justify-center text-white text-xs font-semibold leading-none p-0"
                  title="Modifier le rendez-vous">
                  ✎
              </button>
            </form>
            <form method="POST" action="/rdv/supp" class="m-0 p-0 leading-none">
                <input type="hidden" name="id" value="<%= app.id %>">
                <input type="hidden" name="day" value="<%= day %>">
                <input type="hidden" name="month" value="<%= month %>">
                <input type="hidden" name="year" value="<%= year %>">
                <input type="hidden" name="agendaId" value="<%= app.agendaId %>">
                <button
                    type="submit"
                    class="bg-red-600 hover:bg-red-400 w-4 h-4 rounded flex items-center justify-center text-white text-xs font-semibold leading-none p-0"
                    title="Supprimer le rendez-vous">
                    &times;
                </button>
            </form>
        </div>

        <br>
        <%= app.startLabel %> - <%= app.endLabel %>
      </div>
    <% }) %>
  </div>
</div>
