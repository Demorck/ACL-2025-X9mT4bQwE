<div class="flex flex-col flex-1 h-full">
  <div class="flex flex-1 flex-col border border-stone-700 rounded overflow-hidden">

    <div class="flex flex-row">
        <% const weekDays = ["Lun", "Mar", "Mer", "Jeu", "Ven", "Sam", "Dim"]; %>
        <% weekDays.forEach(day => { %>
        <div class="text-center py-2 font-semibold border-b border-stone-700 flex-1 text-xs">
            <%= day %>
        </div>
        <% }) %>
    </div>

    <% data.days.forEach(week => { %>
        <div class="flex flex-row flex-1">
            <% week.forEach(day => { %>
                <div class="flex flex-1">
                    <div class="relative w-full border-r flex-1 border-b p-2 month-day" 
                            data-open-appointment
                            data-year="<%= day.getFullYear() %>"
                            data-month="<%= day.getMonth() %>"
                            data-day="<%= day.getDate() %>"
                        >
                        <div class="text-sm ">
                            <%= day.getDate() %>
                        </div>
                        <div class="flex md:flex-1 flex-col gap-1 mt-1">
                        <% let appointments = data.appointments.filter(a => a.start.getDate() == day.getDate() && a.start.getMonth() == day.getMonth()); 
                            appointments.forEach(app => {
                               
                            %>
                            <div
                                class="text-clip group text-xs truncate px-2 py-1 rounded appointment-color-<%=app.color%> transition appointment-month appointment-color-<%= app.color %>"
                                style="
                                    top: calc(<%= (app.startHour / 24) * 100%>%);
                                    height: calc((<%= app.durationHours %> / 24) * 100%>%);
                                    left: calc(<%= (app.colIndex / app.colCount) * 100%>%);
                                    width: calc(<%= (1 / app.colCount) * 100%>%);
                                "
                                data-agenda="<%= app.agendaId %>"
                                data-start="<%= app.startHour %>"
                                data-duration="<%= app.durationHours %>"
                                data-day="<%= data.day %>"
                                data-month="<%= data.month %>"
                                data-year="<%= data.year %>"
                                data-id="<%= app.id %>"
                                data-appointment
                            >
                            <span class="hidden md:block"><%= app.nom %></span>
                            </div>
                        <% }) %>
                        </div>
                        <% if (day.getMonth() != data.requestedMonth) { 
                            %>
                        <div class="absolute inset-0 pointer-events-none not-month-day"></div>
                        <% } %>
                    </div>
                </div>
            <% }) %> 
        </div> 
    <% }) %>

  </div>
</div>
